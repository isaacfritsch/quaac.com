{% load static %}
<style>
.content {
  word-wrap: break-word; /* fallback for older browsers */
  overflow-wrap: break-word; /* CSS3 property to break long words */
  word-break: break-all; /* break at any character to prevent overflow */
  hyphens: auto; /* add hyphens when breaking words */
}
</style>
<div x-data="{ isOpen: true }">
  <div x-show="isOpen">
    <div class="column" style="background-color: #f5f5f5; padding: 10px;"> 
      <div class="column has-text-right">          
        <button @click="isOpen = !isOpen" class="delete"></button>
      </div> 
      {% for comentario in comentarios %}
      <div class="columns">
        <div class="column is-2">
          <article class="media">
            <div class="media-content">
              <p class="title is-6">{{ comentario.autor.name }}</p>
              <p class="subtitle is-7">{{ comentario.data }}</p>
            </div>
          </article>
        </div>
        <div class="column is-10">
          <div class="box">
            <article class="media">
              <div class="media-content">
                <div class="content">
                  <p>{{ comentario.body|safe }}</p>
                  <div class="buttons">
                    <button class="button is-ghost">
                      <span class="icon is-small">
                        <i class="fa-regular fa-thumbs-up"></i>
                      </span>
                      <span>Like (0)</span>
                    </button>
                    <button class="button is-ghost"
                    hx-get="{% url 'add_reply' %}"
                    hx-vals='{"comentario": "{{comentario.id}}"}'        
                    hx-target="#comentario_{{ comentario.id }}"                    
                    hx-trigger="click, replysalvo from:body"
                    hx-swap="innerHTML">
                      <span class="icon is-small">
                        <i class="fa-solid fa-reply"></i>
                      </span>
                      <span >Respostas ({{ comentario.replies.count }}) </span>
                    </button>
                  </div>
                </div>
                <div id="comentario_{{ comentario.id }}">
                </div>
              </div>
              {% if user.is_authenticated and comentario.autor == settings.AUTH_USER_MODEL %}
              <div x-data="{comentarioconfirmardeletar : false}">
                <div class="media-right">
                  <div class="buttons">
                    <button class="button is-ghost">
                      <span class="icon is-small">
                        <i class="fa-solid fa-edit"></i>
                      </span>
                    </button>
                    <button class="button is-ghost" @click="comentarioconfirmardeletar = true">
                      <span class="icon is-small">
                        <i class="fa-solid fa-trash"></i>
                      </span>
                    </button>
                  </div>
                </div>
                <div x-cloak x-show="comentarioconfirmardeletar" class="notification is-info is-light">
                  <h1 class="title is-5">Tem certeza que deseja excluir o comentário?</h1>
                  <div class="columns is-mobile">
                    <div class="column">
                      <button class="button is-danger"
                      hx-post="{% url 'delete_comentario' %}"
                      hx-vals='{"comentario": "{{comentario.id}}"}'                                       
                      hx-trigger="click"
                      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                      @click.stop.prevent="comentarioconfirmardeletar = false">
                        Deletar
                      </button>
                    </div>
                    <div class="column is-narrow">
                      <button class="button is-light" @click.stop.prevent="comentarioconfirmardeletar = false">
                        Cancelar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
            </article>
          </div>
        </div>
        <hr>
      </div>
    {% endfor %}
              
        {% if request.user.is_authenticated %}
        
        <form class="form" name="form"      
            hx-post = {{request.path}}
            hx-vals='{"question": "{{question.id}}"}'
            hx-trigger="submit"                                  
          >
          {% csrf_token %}
          
          <article class="media">
            <div class="media-left">
              <p class="title is-5">{{ request.user.name }}</p>
            </div>
            <div class="media-content">
              <form action="" method="post">
                {% csrf_token %}
                <div class="field">
                  {{ form.body }}                  
                </div>
                <div class="field">
                  <p class="control">
                    <button type="submit" class="button is-info">Postar</button>
                  </p>
                </div>
              </form>
            </div>
          </article>         

        </form>
        {% else %}
          <div class="notification is-danger">Faça login para postar um comentário</div>
        {% endif %}    
    </div>
  </div>
</div>
