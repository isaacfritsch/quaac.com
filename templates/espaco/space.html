{% extends 'base.html' %}
{%block content%}
<div id="selectedTagsData" style="display: none;">
  {{ selected_tags_json }}
</div>
<script type="text/javascript">
  function updateMinhalista(updatedData) {
    window.minhalista = JSON.parse(updatedData);

}

  document.addEventListener('eventupdateselectedtags', function(evt) {
    updateMinhalista(evt.detail.selected_tags_json)
});

  window.addEventListener('load', function(evt) { 
    selectedTagsJson = document.getElementById('selectedTagsData').textContent;
    console.log(selectedTagsJson) 

    updateMinhalista(selectedTagsJson);
});
</script>
<style>
  .panel-tabs-scrollable {
    overflow-x: auto;
    white-space: nowrap;
    text-align: center;
  }
  
  .panel-tabs {
    display: inline-block;
    white-space: nowrap;
  }
</style>
<!-- Modal tag-->
<div id="modal-tag">
</div>
<div id="editar-tag-modal">
</div>
<section class="hero is-small is-link">
    <div class="hero-body">
      <div class="columns is-mobile">
        <div class="column">
          <p class="title is-size-2">
            {{espaco.title}}
          </p>
            <p class="subtitle is-size-7">
              {{espaco.description}}
            </p>
        </div>
        <div class="column is-narrow">
          <div x-data="{ isdropdownOpen: false }" x-bind:class="isdropdownOpen ? 'is-active' : ''" class="dropdown is-right" x-cloak>
            <div class="dropdown-trigger">
              <button @click.stop.prevent="isdropdownOpen = !isdropdownOpen" @click.stop.outside="isdropdownOpen = false" class="button is-medium is-primary" aria-haspopup="true" aria-controls="dropdown-menu">
                
                <span>Adicionar nova questão</span>
                <span class="icon is-small">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </div>
            <div class="dropdown-menu"  id="dropdown-menu" role="menu">
              <div class="dropdown-content">
                <a href="" class=" dropdown-item">
                  <span class="icon is-small">
                    <i class="fa-solid fa-plus"></i>
                  </span><span> múltipla escolha</span>
                  
                </a>
                <a href="" class="dropdown-item">
                  <span class="icon is-small">
                    <i class="fa-solid fa-plus"></i>
                  </span>
                  <span>discursiva</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>        
      <p class="control has-icons-left">
        <input class="input is-medium is-focused is-danger" type="text" placeholder="Pesquisa de palavras-chave em questões, comentários ou resoluções">
        <span class="icon is-left">
          <i class="fas fa-search" aria-hidden="true"></i>
        </span>
      </p>
    </div>
</section>
<div>
  <nav class="panel" >
    <div class="panel-heading">
      <div class="columns is-mobile">
        <div class="column">
          Painel de Tags
        </div>
        <div class="column is-narrow">
          <div class="buttons is-right">
            <button class="button is-info"
             hx-get="{% url 'tag_creation' espaco=espaco.id %}"             
             hx-target="#modal-tag"
             hx-trigger="click"
             x-cloak
             @click.stop="modaltagopen = !modaltagopen">
             <span class="icon is-small">
              <i class="fa-regular fa-square-plus"></i>
            </span>
             <p>Criar nova tag</p></button>
          </div>
        </div>
      </div>
    </div>
    <div class="panel-block has-background-success has-text-white p-2 has-border-success"
      x-cloak
      x-show="successmessage"
      @taglistchanged.window = "successmessage = !successmessage"
      @taglistchanged.window.debounce.3000ms="successmessage = !successmessage"
      >
      <span class="icon">
        <i class="fa-solid fa-circle-check"></i>
      </span>
      <p>Alterações salvas com sucesso!</p>
    </div>
    <div class="panel-block">
      <p class="control has-icons-left">
        <input class="input" 
        type="text"
        placeholder="Pesquisar entre todas as tags"
        hx-post="{% url 'search_tag' %}"
        hx-target='#tag_selection'
        hx-vals='{"espaco": "{{espaco.id}}"}'
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-trigger="keyup changed delay:500ms"
        name="search"
        >
        <span class="icon is-left">
          <i class="fas fa-search" aria-hidden="true"></i>
        </span>
      </p>      
    </div>
    <div hx-get="{% url 'lista_categorias' %}"
    hx-vals='{"espaco": "{{espaco.id}}"}'
    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
    hx-trigger="load, taglistchanged from:window"
    hx-swap="innerHTML" 
    hx-target="#categoria_lista" 
    >      
    </div> 
    <div id="categoria_lista">
    </div>    
    <div class="columns is-gapless is-multiline is-mobile">
      <div class="column is-7">
        <div id="tag_selection"></div>
      </div>
      <div class="column is-5">
        <div class="box" id="tags_selected">
          {% include 'espaco/tags_selecionadas.html' %}    
        </div>
      </div>
    </div>
  </nav>
</div>

 
  
{%endblock content%}